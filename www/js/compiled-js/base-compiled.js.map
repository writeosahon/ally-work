{"version":3,"sources":["base.js"],"names":[],"mappings":"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","file":"base-compiled.js","sourcesContent":["/**\r\n * Created by UTOPIA SOFTWARE on 3/11/2017.\r\n */\r\n\r\n/**\r\n * file provides the \"base\" framework/utilities required to launch the app. E.g. file creates the base namespace which\r\n * the app is built on.\r\n *\r\n * The author uses the terms 'method' and function interchangeably; likewise the terms 'attribute' and 'property' are\r\n * also used interchangeably\r\n **/\r\n\r\nvar utopiasoftware = {\r\n    ally : {\r\n\r\n        /**\r\n         * method is used to verify a user's phone number. it returns a Promise object. a resolved promise\r\n         * means the phone number was verified; a rejected promise means phone number verification failed.\r\n         *\r\n         * @param phoneNumber\r\n         * @returns {Promise}\r\n         */\r\n        validatePhoneNumber: function(phoneNumber){\r\n\r\n            phoneNumber = \"\" + phoneNumber; // ensure phone number is seen as a string\r\n\r\n            var smsWatcherTimer = null; // holds the timer used to stop the sms watcher\r\n\r\n            var rejectPromise = null; // holds the reject function of the main Promise object\r\n\r\n            if(phoneNumber.startsWith(\"0\")){ // the phone number starts with 0, replace it with international dialing code\r\n                phoneNumber = phoneNumber.replace(\"0\", \"+234\");\r\n            }\r\n            // show a loader message\r\n            $('#hour-glass-loader-modal .modal-message').html(\"Verifying Phone Number...\");\r\n            $('#hour-glass-loader-modal').get(0).show(); // show loader\r\n\r\n            // create the Promise object which will indicate if a phone was verified or not\r\n            var phoneNumberVerifiedPromise = new Promise(function(resolve, reject){\r\n                rejectPromise = reject;\r\n                var randomNumber = \"\"; //holds the random number to be sent in the sms\r\n\r\n                // start listening to the user's sms inbox\r\n                new Promise(function(resolve2, reject2){\r\n                    SMS.startWatch(resolve2, reject2);\r\n                }).\r\n                then(function(){ // intercept any incoming sms\r\n                    return new Promise(function(res, rej){\r\n                        SMS.enableIntercept(true, res, rej);\r\n                    });\r\n                }).\r\n                then(function(){ // sms watch of the user's inbox has been started\r\n                    // add listener for new arriving sms\r\n                    document.addEventListener('onSMSArrive', function(smsEvent){\r\n                        var sms = smsEvent.data;\r\n                        if(sms.address == phoneNumber && sms.body == \"ALLY \" + randomNumber){\r\n                            clearTimeout(smsWatcherTimer); // stop the set timer\r\n                            SMS.stopWatch(function(){}, function(){}); // stop sms watch\r\n                            SMS.enableIntercept(false, function(){}, function(){}); // stop sms intercept\r\n                            document.removeEventListener('onSMSArrive'); // remove sms arrival listener\r\n                            $('#hour-glass-loader-modal').get(0).hide(); // hide loader\r\n                            resolve(); // resolve promise\r\n                        }\r\n                    });\r\n\r\n                    // return a Promise object which sends sms to the phoneNumber parameter\r\n                    return new Promise(function(resolve3, reject3){\r\n\r\n                        var randomGen = new Random(Random.engines.nativeMath); // random number generator\r\n\r\n                        for(var i = 0; i < 6; i++){\r\n                            randomNumber += \"\" + randomGen.integer(0, 9);\r\n                        }\r\n                        SMS.sendSMS(phoneNumber, \"ALLY \" + randomNumber, resolve3, function(){\r\n                            reject3(\"SMS sending failed. Please ensure you have sufficient airtime on the specified phone number\"); // flag an error that sms verification code could not be sent\r\n                        });\r\n                    });\r\n                }).\r\n                then(function(){\r\n                    smsWatcherTimer = setTimeout(function(){\r\n                        SMS.stopWatch(function(){}, function(){});\r\n                        SMS.enableIntercept(false, function(){}, function(){}); // stop sms intercept\r\n                        document.removeEventListener('onSMSArrive');\r\n                        $('#hour-glass-loader-modal').get(0).hide(); // hide loader\r\n                        rejectPromise(\"phone number verification failed\"); // reject the promise i.e. verification failed\r\n                    }, 31000);\r\n                }).\r\n                catch(function(error){\r\n                    try{\r\n                        clearTimeout(smsWatcherTimer);\r\n                    }\r\n                    catch(err){}\r\n                    SMS.stopWatch(function(){}, function(){});\r\n                    SMS.enableIntercept(false, function(){}, function(){}); // stop sms intercept\r\n                    document.removeEventListener('onSMSArrive');\r\n                    $('#hour-glass-loader-modal').get(0).hide(); // hide loader\r\n                    if(error && typeof error == \"string\"){\r\n                        reject(error);\r\n                    }\r\n                    reject(\"phone number verification failed\");\r\n                });\r\n            });\r\n\r\n            return phoneNumberVerifiedPromise;\r\n        }\r\n    }\r\n};\r\n"]}